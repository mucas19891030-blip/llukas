<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Usuário - Banco Bancário</title>
    <link rel="icon" href="../img/mobile-banking (1).png" type="image/png">
    <link rel="stylesheet" href="../banco.css/styles.css">
    <style>
        /* Estilos para mensagens e interface */
        .error-message { background-color: #fee2e2; border: 1px solid #fecaca; color: #dc2626; padding: 15px; border-radius: 8px; display: none; margin-bottom: 20px; font-size: 0.875rem; }
        .error-message.show { display: block; }
        .success-message { background-color: #dcfce7; border: 1px solid #bbf7d0; color: #16a34a; padding: 15px; border-radius: 8px; display: none; margin-bottom: 20px; font-size: 0.875rem; }
        .success-message.show { display: block; }
        .user-info-box { background-color: var(--secondary); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; margin-top: 20px; display: none; }
        .user-info-box.show { display: block; }
        .user-info-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); }
        .user-info-item:last-child { border-bottom: none; }
        .user-info-label { font-weight: 600; color: var(--foreground); }
        .user-info-value { color: var(--primary); font-family: var(--font-mono); font-weight: 500; }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-back"><a href="inicio.html" class="back-button">← Voltar</a></div>
            <h1 class="header-title">Cadastro de Usuário</h1>
            <p class="header-subtitle">Crie uma nova conta bancária</p>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="form-container">
                <div class="form-card">
                    <div class="form-icon user-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>

                    <div class="error-message" id="registerError"></div>
                    <div class="success-message" id="registerSuccess"></div>

                    <form id="userForm" class="form">
                        <div class="form-group">
                            <label for="fullName" class="form-label">Nome Completo</label>
                            <input id="fullName" type="text" placeholder="João da Silva" class="form-input" required>
                            <p class="form-hint">Digite seu nome completo</p>
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label">Email</label>
                            <input id="email" type="email" placeholder="seu@gmail.com" class="form-input" required>
                            <p class="form-hint">O email será usado como identificador único da conta</p>
                        </div>

                        <button type="submit" class="btn btn-primary btn-full">Criar Conta</button>
                    </form>

                    <div class="user-info-box" id="userInfoBox">
                        <h3 style="margin-top: 0; color: var(--primary);">Conta Criada com Sucesso!</h3>
                        <div class="user-info-item"><span class="user-info-label">ID da Conta:</span><span class="user-info-value" id="displayUserId">-</span></div>
                        <div class="user-info-item"><span class="user-info-label">Nome:</span><span class="user-info-value" id="displayUserName">-</span></div>
                        <div class="user-info-item"><span class="user-info-label">Email:</span><span class="user-info-value" id="displayUserEmail">-</span></div>
                        <div class="user-info-item"><span class="user-info-label">Saldo Inicial:</span><span class="user-info-value" id="displayUserBalance">R$ 0,00</span></div>
                    </div>

                    <div class="info-box">
                        <p><strong>Importante:</strong></p>
                        <ul class="info-list">
                            <li>• Cada email só pode ser usado uma vez</li>
                            <li>• Você receberá uma conta com saldo inicial de R$ 0,00</li>
                            <li>• Um ID único de 11 números será gerado automaticamente</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container"><p>&copy; 2026 Banco Bancário. Todos os direitos reservados.</p></div>
    </footer>

    <!-- Importando apenas a classe User necessária -->
    <script src="../banco.js/user.js"></script>

    <script>
        // Função para formatar moeda
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        // Lógica do Formulário usando a Classe User
        document.getElementById('userForm').addEventListener('submit', async function(evento) {
            evento.preventDefault();

            const nomeDigitado = document.getElementById('fullName').value.trim();
            const emailDigitado = document.getElementById('email').value.trim();
            
            const divErro = document.getElementById('registerError');
            const divSucesso = document.getElementById('registerSuccess');
            const infoBox = document.getElementById('userInfoBox');

            // Limpa mensagens anteriores
            divErro.classList.remove('show');
            divSucesso.classList.remove('show');
            infoBox.classList.remove('show');

            // Validação básica de nome
            if (nomeDigitado.length < 3) {
                divErro.textContent = 'O nome deve ter pelo menos 3 caracteres.';
                divErro.classList.add('show');
                return;
            }

            // 1. Cria uma nova instância da Classe User (definida no seu banco.js/user.js)
            const novoUsuario = new User(nomeDigitado, emailDigitado);

            // 2. Chama o método da classe para salvar no banco de dados via PHP
            const resultado = await novoUsuario.salvarNoBanco();

            if (resultado.sucesso) {
                // 3. Sucesso: Mostra os dados e redireciona
                divSucesso.textContent = "Conta criada com sucesso! Seus dados foram salvos no banco de dados.";
                divSucesso.classList.add('show');

                document.getElementById('displayUserId').textContent = novoUsuario.id;
                document.getElementById('displayUserName').textContent = novoUsuario.nome;
                document.getElementById('displayUserEmail').textContent = novoUsuario.email;
                document.getElementById('displayUserBalance').textContent = formatCurrency(0);
                infoBox.classList.add('show');

                // Salva o email na sessão para identificar o usuário logado
                sessionStorage.setItem('currentUserEmail', novoUsuario.email);

                // Redireciona para a index.html após 3 segundos
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            } else {
                // 4. Erro: Mostra a mensagem retornada pelo PHP (ex: email duplicado)
                divErro.textContent = resultado.mensagem;
                divErro.classList.add('show');
            }
        });
    </script>
</body>
</html>
